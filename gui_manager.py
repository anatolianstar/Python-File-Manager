"""
GUI Manager Module
Ana GUI yapƒ±sƒ±nƒ± ve pencere y√∂netimini i√ßerir
"""

import tkinter as tk
from tkinter import ttk, messagebox, filedialog
import os
from pathlib import Path

# Multi-language support
from lang_manager import t, set_language, get_languages, lang_manager
from language_switcher import LanguageSwitcher

class GUIManager:
    def __init__(self, root):
        self.root = root
        self.setup_main_window()
        self.setup_variables()
        self.setup_ui()
        
    def setup_main_window(self):
        """Ana pencere ayarlarƒ±"""
        self.root.title(t('app.title'))
        self.root.geometry("1400x800")
        self.root.minsize(1000, 600)
        
        # Icon ayarla (varsa)
        try:
            self.root.iconbitmap("icon.ico")
        except:
            pass
    
    def setup_variables(self):
        """UI deƒüi≈ükenlerini tanƒ±mla"""
        # Klas√∂r yollarƒ±
        self.source_var = tk.StringVar()
        self.target_var = tk.StringVar()
        self.current_path_var = tk.StringVar()
        
        # Tarama se√ßenekleri
        self.scan_subfolders = tk.BooleanVar(value=True)
        
        # Yeni tarama modu deƒüi≈ükeni: "all", "none", "files_only"
        self.scan_mode = tk.StringVar(value="all")
        
        # Duplikat kontrol se√ßenekleri
        self.duplicate_check_name = tk.BooleanVar(value=True)
        self.duplicate_check_size = tk.BooleanVar(value=True)
        self.duplicate_check_hash = tk.BooleanVar(value=False)
        self.duplicate_action = tk.StringVar(value="ask")
        
        # Progress ve status
        self.progress_var = tk.DoubleVar()
        self.status_var = tk.StringVar(value=t('status.ready'))
        
        # Time estimation variables
        self.time_estimation_var = tk.StringVar(value="")
        self.operation_start_time = None
        self.last_progress_time = None
        self.estimated_total_time = None
        
        # Multi-language StringVars for dynamic text updates
        self.ui_texts = {
            'source_label': tk.StringVar(value=t('menu.file.select_source')),
            'target_label': tk.StringVar(value=t('menu.file.select_target')),
            'location_label': tk.StringVar(value=t('labels.location') + ":"),
            'scan_mode_label': tk.StringVar(value=t('labels.scan_mode')),
        }
        
        # Tab ba≈ülƒ±klarƒ± i√ßin deƒüi≈ükenler
        self.tab_references = {}
        
        # Widget references for dynamic updates
        self.ui_widgets = {}
        
    def setup_ui(self):
        """Ana UI bile≈üenlerini olu≈ütur"""
        # Ana frame
        main_frame = ttk.Frame(self.root)
        main_frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
        
        # √úst panel - Klas√∂r se√ßimi
        self.setup_folder_selection(main_frame)
        
        # Orta panel - ƒ∞ki pencere
        self.setup_main_panels(main_frame)
        
        # Alt panel - Kontroller ve durum
        self.setup_bottom_panel(main_frame)
        
    def setup_folder_selection(self, parent):
        """Klas√∂r se√ßim paneli"""
        top_frame = ttk.Frame(parent)
        top_frame.pack(fill=tk.X, pady=(0, 10))
        
        # Language switcher - saƒü √ºst k√∂≈üe
        lang_frame = ttk.Frame(top_frame)
        lang_frame.grid(row=0, column=3, sticky=tk.E, padx=(10, 0))
        
        self.language_switcher = LanguageSwitcher(lang_frame, self.on_language_change)
        self.language_switcher.pack()
        
        # Source klas√∂r se√ßimi
        self.ui_widgets['source_label'] = ttk.Label(top_frame, textvariable=self.ui_texts['source_label'])
        self.ui_widgets['source_label'].grid(row=0, column=0, sticky=tk.W, padx=(0, 5))
        ttk.Entry(top_frame, textvariable=self.source_var, width=50).grid(row=0, column=1, padx=(0, 5))
        self.ui_widgets['select_btn'] = ttk.Button(top_frame, text=t('buttons.select'), command=self.select_source_folder)
        self.ui_widgets['select_btn'].grid(row=0, column=2)
        
        # Target SSD se√ßimi
        self.ui_widgets['target_label'] = ttk.Label(top_frame, textvariable=self.ui_texts['target_label'])
        self.ui_widgets['target_label'].grid(row=1, column=0, sticky=tk.W, padx=(0, 5), pady=(5, 0))
        ttk.Entry(top_frame, textvariable=self.target_var, width=50).grid(row=1, column=1, padx=(0, 5), pady=(5, 0))
        self.ui_widgets['change_btn'] = ttk.Button(top_frame, text=t('buttons.change'), command=self.select_target_folder)
        self.ui_widgets['change_btn'].grid(row=1, column=2, pady=(5, 0))
        
        # Alt klas√∂r tarama se√ßeneƒüi
        self.setup_scan_options(top_frame)
        
    def setup_scan_options(self, parent):
        """Tarama se√ßenekleri"""
        scan_frame = ttk.Frame(parent)
        scan_frame.grid(row=2, column=0, columnspan=3, sticky=tk.W, pady=(10, 0))
        
        self.ui_widgets['scan_mode_label'] = ttk.Label(scan_frame, textvariable=self.ui_texts['scan_mode_label'])
        self.ui_widgets['scan_mode_label'].pack(side=tk.LEFT, padx=(0, 10))
        
        # Se√ßenek 1: T√ºm alt klas√∂rleri tara
        self.ui_widgets['scan_all_radio'] = ttk.Radiobutton(scan_frame, text=t('scan_options.scan_all'), 
                       variable=self.scan_mode, value="all")
        self.ui_widgets['scan_all_radio'].pack(side=tk.LEFT, padx=(0, 15))
        
        # Se√ßenek 2: Klas√∂rleri komple kopyala
        self.ui_widgets['scan_none_radio'] = ttk.Radiobutton(scan_frame, text=t('scan_options.copy_folders'), 
                       variable=self.scan_mode, value="none")
        self.ui_widgets['scan_none_radio'].pack(side=tk.LEFT, padx=(0, 15))
        
        # Se√ßenek 3: Sadece dosyalarƒ± tara (YENƒ∞)
        self.ui_widgets['scan_files_radio'] = ttk.Radiobutton(scan_frame, text=t('scan_options.files_only'), 
                       variable=self.scan_mode, value="files_only")
        self.ui_widgets['scan_files_radio'].pack(side=tk.LEFT)
        
        # Hatƒ±rlatma mesajƒ±
        reminder_frame = ttk.Frame(parent)
        reminder_frame.grid(row=3, column=0, columnspan=3, sticky=tk.W, pady=(5, 0))
        
        self.ui_widgets['reminder_label'] = ttk.Label(reminder_frame, text=t('scan_options.reminder'), 
                                 foreground="blue", font=('Arial', 8, 'italic'))
        self.ui_widgets['reminder_label'].pack(side=tk.LEFT, padx=(20, 0))
        
    def setup_main_panels(self, parent):
        """Ana paneller - sol ve saƒü"""
        middle_frame = ttk.Frame(parent)
        middle_frame.pack(fill=tk.BOTH, expand=True, pady=(0, 10))
        
        # Sol panel - Hedef File Manager
        self.setup_target_panel(middle_frame)
        
        # Saƒü panel - Kaynak Dosyalar ve Organizasyon
        self.setup_source_panel(middle_frame)
        
    def setup_target_panel(self, parent):
        """Sol panel - Hedef klas√∂r file manager"""
        self.ui_widgets['target_panel'] = ttk.LabelFrame(parent, text=t('panels.target_manager'))
        self.ui_widgets['target_panel'].pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(0, 5))
        left_frame = self.ui_widgets['target_panel']
        
        # Navigasyon kontrolleri
        nav_frame = ttk.Frame(left_frame)
        nav_frame.pack(fill=tk.X, padx=5, pady=(5, 0))
        
        self.ui_widgets['back_btn'] = ttk.Button(nav_frame, text="‚óÄ " + t('buttons.back'), command=self.go_back)
        self.ui_widgets['back_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['up_btn'] = ttk.Button(nav_frame, text="‚ñ≤ " + t('buttons.up'), command=self.go_up)
        self.ui_widgets['up_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['home_btn'] = ttk.Button(nav_frame, text="üè† " + t('buttons.home'), command=self.go_home)
        self.ui_widgets['home_btn'].pack(side=tk.LEFT, padx=(0, 5))
        
        # Yol g√∂sterge √ßubuƒüu
        path_frame = ttk.Frame(left_frame)
        path_frame.pack(fill=tk.X, padx=5, pady=(5, 0))
        
        self.ui_widgets['location_label'] = ttk.Label(path_frame, textvariable=self.ui_texts['location_label'])
        self.ui_widgets['location_label'].pack(side=tk.LEFT)
        self.path_entry = ttk.Entry(path_frame, textvariable=self.current_path_var, font=('Consolas', 9))
        self.path_entry.pack(side=tk.LEFT, fill=tk.X, expand=True, padx=(5, 5))
        self.path_entry.bind('<Return>', self.navigate_to_path)
        self.ui_widgets['go_btn'] = ttk.Button(path_frame, text=t('buttons.go'), command=self.navigate_to_path)
        self.ui_widgets['go_btn'].pack(side=tk.RIGHT)

        # File manager kontrolleri
        target_controls = ttk.Frame(left_frame)
        target_controls.pack(fill=tk.X, padx=5, pady=5)
        
        self.ui_widgets['refresh_btn'] = ttk.Button(target_controls, text="üîÑ " + t('buttons.refresh'), command=self.refresh_target)
        self.ui_widgets['refresh_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['delete_btn'] = ttk.Button(target_controls, text="üóëÔ∏è " + t('buttons.delete'), command=self.delete_selected)
        self.ui_widgets['delete_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['copy_btn'] = ttk.Button(target_controls, text="üìã " + t('buttons.copy'), command=self.copy_selected)
        self.ui_widgets['copy_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['cut_btn'] = ttk.Button(target_controls, text="‚úÇÔ∏è " + t('buttons.cut'), command=self.cut_selected)
        self.ui_widgets['cut_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['paste_btn'] = ttk.Button(target_controls, text="üìÅ " + t('buttons.paste'), command=self.paste_selected)
        self.ui_widgets['paste_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['new_folder_btn'] = ttk.Button(target_controls, text="‚ûï " + t('buttons.new_folder'), command=self.create_folder)
        self.ui_widgets['new_folder_btn'].pack(side=tk.LEFT, padx=(0, 5))
        
        # Hedef klas√∂r aƒüacƒ±
        self.setup_target_tree(left_frame)
        
    def setup_target_tree(self, parent):
        """Hedef klas√∂r tree widget"""
        target_frame = ttk.Frame(parent)
        target_frame.pack(fill=tk.BOTH, expand=True, padx=5, pady=(0, 5))
        
        self.target_tree = ttk.Treeview(target_frame, columns=('size', 'type', 'modified'), show='tree headings')
        self.target_tree.heading('#0', text='üìÅ ' + t('labels.file_folder_name'), command=lambda: self.sort_tree('#0'))
        self.target_tree.heading('size', text='üìè ' + t('labels.size'), command=lambda: self.sort_tree('size'))
        self.target_tree.heading('type', text='üè∑Ô∏è ' + t('labels.type'), command=lambda: self.sort_tree('type'))
        self.target_tree.heading('modified', text='üìÖ ' + t('labels.modified'), command=lambda: self.sort_tree('modified'))
        self.target_tree.column('#0', width=250)
        self.target_tree.column('size', width=80)
        self.target_tree.column('type', width=80)
        self.target_tree.column('modified', width=120)
        
        target_scrollbar = ttk.Scrollbar(target_frame, orient=tk.VERTICAL, command=self.target_tree.yview)
        self.target_tree.configure(yscrollcommand=target_scrollbar.set)
        
        self.target_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        target_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        # Event bindings
        self.setup_target_tree_events()
    
    def on_language_change(self, lang_code):
        """Dil deƒüi≈ütirildiƒüinde t√ºm UI'ƒ± g√ºncelle"""
        # Ana pencere ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle
        self.root.title(t('app.title'))
        
        # T√ºm widget'larƒ± yeniden y√ºkle
        self.refresh_ui_texts()
        
    def refresh_ui_texts(self):
        """T√ºm UI metinlerini yenile"""
        # StringVar'larƒ± g√ºncelle
        self.ui_texts['source_label'].set(t('menu.file.select_source'))
        self.ui_texts['target_label'].set(t('menu.file.select_target'))
        self.ui_texts['location_label'].set(t('labels.location') + ":")
        self.ui_texts['scan_mode_label'].set(t('labels.scan_mode'))
        
        # LabelFrame'i g√ºncelle (config ile)
        if 'target_panel' in self.ui_widgets:
            self.ui_widgets['target_panel'].config(text=t('panels.target_manager'))
        
        # Button metinlerini g√ºncelle
        if 'select_btn' in self.ui_widgets:
            self.ui_widgets['select_btn'].config(text=t('buttons.select'))
        if 'change_btn' in self.ui_widgets:
            self.ui_widgets['change_btn'].config(text=t('buttons.change'))
        if 'back_btn' in self.ui_widgets:
            self.ui_widgets['back_btn'].config(text="‚óÄ " + t('buttons.back'))
        if 'up_btn' in self.ui_widgets:
            self.ui_widgets['up_btn'].config(text="‚ñ≤ " + t('buttons.up'))
        if 'home_btn' in self.ui_widgets:
            self.ui_widgets['home_btn'].config(text="üè† " + t('buttons.home'))
        if 'go_btn' in self.ui_widgets:
            self.ui_widgets['go_btn'].config(text=t('buttons.go'))
        if 'refresh_btn' in self.ui_widgets:
            self.ui_widgets['refresh_btn'].config(text="üîÑ " + t('buttons.refresh'))
        if 'delete_btn' in self.ui_widgets:
            self.ui_widgets['delete_btn'].config(text="üóëÔ∏è " + t('buttons.delete'))
        if 'copy_btn' in self.ui_widgets:
            self.ui_widgets['copy_btn'].config(text="üìã " + t('buttons.copy'))
        if 'cut_btn' in self.ui_widgets:
            self.ui_widgets['cut_btn'].config(text="‚úÇÔ∏è " + t('buttons.cut'))
        if 'paste_btn' in self.ui_widgets:
            self.ui_widgets['paste_btn'].config(text="üìÅ " + t('buttons.paste'))
        if 'new_folder_btn' in self.ui_widgets:
            self.ui_widgets['new_folder_btn'].config(text="‚ûï " + t('buttons.new_folder'))
        
        # Tree headings g√ºncelle
        if hasattr(self, 'target_tree'):
            self.target_tree.heading('#0', text='üìÅ ' + t('labels.file_folder_name'))
            self.target_tree.heading('size', text='üìè ' + t('labels.size'))
            self.target_tree.heading('type', text='üè∑Ô∏è ' + t('labels.type'))
            self.target_tree.heading('modified', text='üìÖ ' + t('labels.modified'))
        
        # Status g√ºncelle
        if (self.status_var.get() == t('status.ready') or 
            self.status_var.get() == "Hazƒ±r" or self.status_var.get() == "Ready"):
            self.status_var.set(t('status.ready'))
        
        # Scan options g√ºncelle
        if 'scan_all_radio' in self.ui_widgets:
            self.ui_widgets['scan_all_radio'].config(text=t('scan_options.scan_all'))
        if 'scan_none_radio' in self.ui_widgets:
            self.ui_widgets['scan_none_radio'].config(text=t('scan_options.copy_folders'))
        if 'scan_files_radio' in self.ui_widgets:
            self.ui_widgets['scan_files_radio'].config(text=t('scan_options.files_only'))
        if 'reminder_label' in self.ui_widgets:
            self.ui_widgets['reminder_label'].config(text=t('scan_options.reminder'))
        
        # Bottom panel butonlarƒ± g√ºncelle
        if 'scan_btn' in self.ui_widgets:
            self.ui_widgets['scan_btn'].config(text=t('buttons.scan'))
        if 'analyze_btn' in self.ui_widgets:
            self.ui_widgets['analyze_btn'].config(text=t('buttons.analyze'))
        if 'organize_btn' in self.ui_widgets:
            self.ui_widgets['organize_btn'].config(text=t('buttons.organize'))
        
        # Duplicate tab g√ºncellemeleri
        if hasattr(self, 'duplicate_tree'):
            self.duplicate_tree.heading('#0', text=t('duplicates.groups'))
            self.duplicate_tree.heading('path', text=t('labels.file_path'))
            self.duplicate_tree.heading('size', text=t('duplicates.size'))
            self.duplicate_tree.heading('hash', text=t('duplicates.hash'))
        
        # Duplicate control g√ºncellemeleri
        if 'dup_control_label' in self.ui_widgets:
            self.ui_widgets['dup_control_label'].config(text=t('duplicates.control_label'))
        if 'dup_name_check' in self.ui_widgets:
            self.ui_widgets['dup_name_check'].config(text=t('duplicates.name'))
        if 'dup_size_check' in self.ui_widgets:
            self.ui_widgets['dup_size_check'].config(text=t('duplicates.size'))
        if 'dup_hash_check' in self.ui_widgets:
            self.ui_widgets['dup_hash_check'].config(text=t('duplicates.hash'))
        if 'dup_action_label' in self.ui_widgets:
            self.ui_widgets['dup_action_label'].config(text=t('duplicates.action_label'))
        if 'dup_ask_radio' in self.ui_widgets:
            self.ui_widgets['dup_ask_radio'].config(text=t('duplicates.ask'))
        if 'dup_skip_radio' in self.ui_widgets:
            self.ui_widgets['dup_skip_radio'].config(text=t('duplicates.skip'))
        if 'dup_copy_radio' in self.ui_widgets:
            self.ui_widgets['dup_copy_radio'].config(text=t('duplicates.copy'))
        
        # Preview tab g√ºncellemeleri
        if hasattr(self, 'preview_tree'):
            self.preview_tree.heading('#0', text=t('labels.folder_structure'))
            self.preview_tree.heading('count', text=t('labels.file_count'))
        
        # Source tab g√ºncellemeleri
        if hasattr(self, 'source_tree'):
            self.source_tree.heading('#0', text=t('source_tab.file_name'))
            self.source_tree.heading('size', text=t('source_tab.size'))
            self.source_tree.heading('type', text=t('source_tab.type'))
        
        # Panel ba≈ülƒ±klarƒ± g√ºncelle
        if 'target_panel' in self.ui_widgets:
            self.ui_widgets['target_panel'].config(text=t('panels.target_manager'))
        if 'source_panel' in self.ui_widgets:
            self.ui_widgets['source_panel'].config(text=t('panels.source_organization'))
        
        # Tab ba≈ülƒ±klarƒ±nƒ± g√ºncelle
        if hasattr(self, 'notebook'):
            try:
                # T√ºm tab ba≈ülƒ±klarƒ±nƒ± g√ºncelle
                for i in range(self.notebook.index("end")):
                    tab_text = self.notebook.tab(i, "text")
                    if "Kaynak" in tab_text or "Source" in tab_text:
                        self.notebook.tab(i, text=t('source_tab.title'))
                    elif "√ñnizleme" in tab_text or "Preview" in tab_text:
                        self.notebook.tab(i, text=t('tabs.preview'))
                    elif "Duplikat" in tab_text or "Duplicate" in tab_text:
                        self.notebook.tab(i, text=t('tabs.duplicates'))
            except Exception as e:
                print(f"Tab ba≈ülƒ±ƒüƒ± g√ºncelleme hatasƒ±: {e}")
        
    def setup_target_tree_events(self):
        """Target tree event bindings - Bu event'ler main_modular.py'de baƒülanacak"""
        # Event bindings main_modular.py rebind_events() fonksiyonunda yapƒ±lƒ±yor
        # Bu fonksiyon artƒ±k gerekli deƒüil
        pass
    
    def setup_source_panel(self, parent):
        """Saƒü panel - Kaynak dosyalar ve organizasyon"""
        self.ui_widgets['source_panel'] = ttk.LabelFrame(parent, text=t('panels.source_organization'))
        self.ui_widgets['source_panel'].pack(side=tk.RIGHT, fill=tk.BOTH, expand=True, padx=(5, 0))
        right_frame = self.ui_widgets['source_panel']
        
        # Notebook i√ßin tab'lar
        self.notebook = ttk.Notebook(right_frame)
        self.notebook.pack(fill=tk.BOTH, expand=True, padx=5, pady=5)
        
        # Tab 1: Kaynak dosyalar
        self.setup_source_tab()
        
        # Tab 2: Organizasyon √∂nizleme
        self.setup_preview_tab()
        
        # Tab 3: Duplikat dosyalar
        self.setup_duplicate_tab()
        
    def setup_source_tab(self):
        """Kaynak dosyalar tab"""
        source_tab = ttk.Frame(self.notebook)
        self.notebook.add(source_tab, text=t('source_tab.title'))
        
        self.source_tree = ttk.Treeview(source_tab, columns=('size', 'type'), show='tree headings')
        self.source_tree.heading('#0', text=t('source_tab.file_name'))
        self.source_tree.heading('size', text=t('source_tab.size'))
        self.source_tree.heading('type', text=t('source_tab.type'))
        self.source_tree.column('#0', width=250)
        self.source_tree.column('size', width=80)
        self.source_tree.column('type', width=80)
        
        source_scrollbar = ttk.Scrollbar(source_tab, orient=tk.VERTICAL, command=self.source_tree.yview)
        self.source_tree.configure(yscrollcommand=source_scrollbar.set)
        
        self.source_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        source_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
    def setup_preview_tab(self):
        """Organizasyon √∂nizleme tab"""
        preview_tab = ttk.Frame(self.notebook)
        self.notebook.add(preview_tab, text=t('tabs.preview'))
        
        self.preview_tree = ttk.Treeview(preview_tab, columns=('count',), show='tree headings')
        self.preview_tree.heading('#0', text=t('labels.folder_structure'))
        self.preview_tree.heading('count', text=t('labels.file_count'))
        self.preview_tree.column('#0', width=250)
        self.preview_tree.column('count', width=100)
        
        preview_scrollbar = ttk.Scrollbar(preview_tab, orient=tk.VERTICAL, command=self.preview_tree.yview)
        self.preview_tree.configure(yscrollcommand=preview_scrollbar.set)
        
        self.preview_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        preview_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
    def setup_duplicate_tab(self):
        """Duplikat dosyalar tab"""
        duplicate_tab = ttk.Frame(self.notebook)
        self.notebook.add(duplicate_tab, text=t('tabs.duplicates'))
        
        # Duplikat kontrol se√ßenekleri
        self.setup_duplicate_controls(duplicate_tab)
        
        # Duplikat tree
        self.setup_duplicate_tree(duplicate_tab)
        
    def setup_duplicate_controls(self, parent):
        """Duplikat kontrol se√ßenekleri"""
        # Duplikat kontrol se√ßenekleri
        dup_controls = ttk.Frame(parent)
        dup_controls.pack(fill=tk.X, padx=5, pady=5)
        
        self.ui_widgets['dup_control_label'] = ttk.Label(dup_controls, text=t('duplicates.control_label'))
        self.ui_widgets['dup_control_label'].pack(side=tk.LEFT)
        self.ui_widgets['dup_name_check'] = ttk.Checkbutton(dup_controls, text=t('duplicates.name'), variable=self.duplicate_check_name)
        self.ui_widgets['dup_name_check'].pack(side=tk.LEFT, padx=(10, 5))
        self.ui_widgets['dup_size_check'] = ttk.Checkbutton(dup_controls, text=t('duplicates.size'), variable=self.duplicate_check_size)
        self.ui_widgets['dup_size_check'].pack(side=tk.LEFT, padx=5)
        self.ui_widgets['dup_hash_check'] = ttk.Checkbutton(dup_controls, text=t('duplicates.hash'), variable=self.duplicate_check_hash)
        self.ui_widgets['dup_hash_check'].pack(side=tk.LEFT, padx=5)
        
        # Duplikat i≈ülem se√ßenekleri
        dup_action_frame = ttk.Frame(parent)
        dup_action_frame.pack(fill=tk.X, padx=5, pady=5)
        
        self.ui_widgets['dup_action_label'] = ttk.Label(dup_action_frame, text=t('duplicates.action_label'))
        self.ui_widgets['dup_action_label'].pack(side=tk.LEFT)
        self.ui_widgets['dup_ask_radio'] = ttk.Radiobutton(dup_action_frame, text=t('duplicates.ask'), 
                       variable=self.duplicate_action, value="ask")
        self.ui_widgets['dup_ask_radio'].pack(side=tk.LEFT, padx=(10, 5))
        self.ui_widgets['dup_skip_radio'] = ttk.Radiobutton(dup_action_frame, text=t('duplicates.skip'), 
                       variable=self.duplicate_action, value="skip")
        self.ui_widgets['dup_skip_radio'].pack(side=tk.LEFT, padx=5)
        self.ui_widgets['dup_copy_radio'] = ttk.Radiobutton(dup_action_frame, text=t('duplicates.copy'), 
                       variable=self.duplicate_action, value="copy")
        self.ui_widgets['dup_copy_radio'].pack(side=tk.LEFT, padx=5)
        
    def setup_duplicate_tree(self, parent):
        """Duplikat dosyalar tree"""
        self.duplicate_tree = ttk.Treeview(parent, columns=('path', 'size', 'hash'), show='tree headings')
        self.duplicate_tree.heading('#0', text=t('duplicates.groups'))
        self.duplicate_tree.heading('path', text=t('labels.file_path'))
        self.duplicate_tree.heading('size', text=t('duplicates.size'))
        self.duplicate_tree.heading('hash', text=t('duplicates.hash'))
        self.duplicate_tree.column('#0', width=200)
        self.duplicate_tree.column('path', width=300)
        self.duplicate_tree.column('size', width=80)
        self.duplicate_tree.column('hash', width=120)
        
        duplicate_scrollbar = ttk.Scrollbar(parent, orient=tk.VERTICAL, command=self.duplicate_tree.yview)
        self.duplicate_tree.configure(yscrollcommand=duplicate_scrollbar.set)
        
        self.duplicate_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        duplicate_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
    def setup_bottom_panel(self, parent):
        """Alt panel - butonlar, progress, status"""
        bottom_frame = ttk.Frame(parent)
        bottom_frame.pack(fill=tk.X)
        
        # Butonlar
        button_frame = ttk.Frame(bottom_frame)
        button_frame.pack(fill=tk.X, pady=(0, 5))
        
        self.ui_widgets['scan_btn'] = ttk.Button(button_frame, text=t('buttons.scan'), command=self.scan_files)
        self.ui_widgets['scan_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['analyze_btn'] = ttk.Button(button_frame, text=t('buttons.analyze'), command=self.analyze_target_disk)
        self.ui_widgets['analyze_btn'].pack(side=tk.LEFT, padx=(0, 5))
        self.ui_widgets['organize_btn'] = ttk.Button(button_frame, text=t('buttons.organize'), command=self.start_organization)
        self.ui_widgets['organize_btn'].pack(side=tk.LEFT, padx=(0, 5))
        
        # Progress bar
        self.progress_bar = ttk.Progressbar(bottom_frame, variable=self.progress_var, maximum=100)
        self.progress_bar.pack(fill=tk.X, pady=(0, 5))
        
        # Time estimation label
        time_frame = ttk.Frame(bottom_frame)
        time_frame.pack(fill=tk.X, pady=(0, 5))
        
        self.time_label = ttk.Label(time_frame, textvariable=self.time_estimation_var, 
                                   font=('Arial', 9), foreground='blue')
        self.time_label.pack(side=tk.RIGHT)
        
        # Durum etiketi
        status_label = ttk.Label(bottom_frame, textvariable=self.status_var)
        status_label.pack(fill=tk.X)
        
    # Placeholder metodlar - main_modular.py'de ger√ßek metodlarla deƒüi≈ütirilecek
    # Placeholder metodlar - main_modular.py'de rebind_buttons() ile deƒüi≈ütirilecek
    def select_source_folder(self):
        """Kaynak klas√∂r se√ßimi - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def select_target_folder(self):
        """Hedef klas√∂r se√ßimi - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def go_back(self):
        """Geri git - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def go_up(self):
        """√úst klas√∂r - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def go_home(self):
        """Ana klas√∂r - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def navigate_to_path(self, event=None):
        """Yola git - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def refresh_target(self):
        """Hedef klas√∂r√º yenile - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def delete_selected(self):
        """Se√ßili dosyalarƒ± sil - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def copy_selected(self):
        """Se√ßili dosyalarƒ± kopyala - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def cut_selected(self):
        """Se√ßili dosyalarƒ± kes - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def paste_selected(self):
        """Dosyalarƒ± yapƒ±≈ütƒ±r - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def create_folder(self):
        """Yeni klas√∂r olu≈ütur - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def sort_tree(self, column):
        """Tree sƒ±ralama - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def on_target_double_click(self, event):
        """√áift tƒ±klama - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def show_context_menu(self, event):
        """Saƒü tƒ±k men√ºs√º - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def rename_selected(self):
        """Dosya adƒ±nƒ± deƒüi≈ütir - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def open_selected(self):
        """Dosya/klas√∂r a√ß - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def scan_files(self):
        """Dosya tarama - scan_engine mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def analyze_target_disk(self):
        """Hedef disk analizi - reporting mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        
    def start_organization(self):
        """Organizasyon ba≈ülat - file_operations mod√ºl√ºnden √ßaƒürƒ±lacak"""
        pass
        

        
    def start_time_estimation(self):
        """Zaman tahmini ba≈ülat"""
        import time
        self.operation_start_time = time.time()
        self.last_progress_time = time.time()
        self.estimated_total_time = None
        self.time_estimation_var.set("")
    
    def update_time_estimation(self, current_progress, processed_items=None, total_items=None):
        """Zaman tahminini g√ºncelle"""
        import time
        from lang_manager import t
        
        if not self.operation_start_time or current_progress <= 0:
            return
        
        current_time = time.time()
        elapsed_time = current_time - self.operation_start_time
        
        # Progress y√ºzdesi 0-100 arasƒ±
        if current_progress >= 100:
            self.time_estimation_var.set(f"‚úÖ {t('time.completed')}")
            return
        
        # Kalan s√ºreyi hesapla
        if current_progress > 0:
            estimated_total_time = elapsed_time * (100 / current_progress)
            remaining_time = estimated_total_time - elapsed_time
            
            if remaining_time > 0:
                # Zamanƒ± formatla
                time_str = self.format_time(remaining_time)
                
                # Ek bilgi varsa ekle
                if processed_items and total_items:
                    remaining_items = total_items - processed_items
                    self.time_estimation_var.set(f"‚è±Ô∏è {t('time.remaining')}: {time_str} ({remaining_items} {t('time.files')})")
                else:
                    self.time_estimation_var.set(f"‚è±Ô∏è {t('time.remaining')}: {time_str}")
            else:
                self.time_estimation_var.set(f"‚è±Ô∏è {t('time.calculating')}")
    
    def format_time(self, seconds):
        """S√ºreyi okunabilir formata √ßevir"""
        from lang_manager import t
        
        if seconds < 60:
            return f"{int(seconds)} {t('time.seconds')}"
        elif seconds < 3600:
            minutes = int(seconds // 60)
            secs = int(seconds % 60)
            return f"{minutes}{t('time.minutes_short')} {secs}{t('time.seconds_short')}"
        else:
            hours = int(seconds // 3600)
            minutes = int((seconds % 3600) // 60)
            return f"{hours}{t('time.hours_short')} {minutes}{t('time.minutes_short')}"
    
    def stop_time_estimation(self):
        """Zaman tahminini durdur"""
        self.operation_start_time = None
        self.last_progress_time = None
        self.estimated_total_time = None
        self.time_estimation_var.set("") 